platform:
  - x64

image: Visual Studio 2017

environment:
  global:
    CYG_ROOT: cygwin64
    CYG_ARCH: x86_64
    CYG_MIRROR: http://mirrors.kernel.org/sourceware/cygwin/
    CYG_CACHE: C:\cygwin\var\cache\setup
    OCAMLROOT: C:\OCaml
  matrix:
    - OCAMLBRANCH: 4.03
      OCAML_PORT: mingw
    - OCAMLBRANCH: 4.04
      OCAML_PORT: mingw64
    - OCAMLBRANCH: 4.05
      OCAML_PORT: cygwin
      CYG_ROOT: cygwin
      CYG_ARCH: x86
    - OCAMLBRANCH: 4.06
      OCAML_PORT: cygwin64
    - OCAMLBRANCH: 4.07
      OCAML_PORT: msvc
      SKIP_OCAML_TEST: no
    - OCAMLBRANCH: trunk
      OCAML_PORT: msvc64
      SKIP_OCAML_TEST: no

cache:
  - C:\OCaml
  - C:\cygwin\var\cache\setup

init:
  - "echo Building on %PLATFORM% for %OCAMLROOT%"

install:
  - call "%APPVEYOR_BUILD_FOLDER%\appveyor_build.cmd" install

build_script:
  - call "%APPVEYOR_BUILD_FOLDER%\appveyor_build.cmd" build

test_script:
  - call "%APPVEYOR_BUILD_FOLDER%\appveyor_build.cmd" test
